# 分支管理策略

## 1. 分支类型与用途

### 1.1 主分支（Main）

- **名称**：`main`
- **用途**：
  - 包含稳定、可部署的代码
  - 作为所有功能开发和修复的基础
  - 仅接受来自其他分支的合并请求
- **保护措施**：
  - 禁止直接推送到 `main` 分支
  - 合并前需要代码审查
  - 合并前需要通过自动化测试

### 1.2 开发分支（Develop）

- **名称**：`develop`
- **用途**：
  - 包含下一个版本的开发代码
  - 集成所有功能开发分支的代码
  - 作为发布前的测试环境
- **保护措施**：
  - 禁止直接推送到 `develop` 分支
  - 合并前需要代码审查
  - 合并前需要通过自动化测试

### 1.3 功能分支（Feature）

- **名称**：`feature/功能名称`
- **用途**：
  - 开发新功能或改进现有功能
  - 基于 `develop` 分支创建
- **生命周期**：
  - 功能开发完成后，合并到 `develop` 分支
  - 合并后删除该分支

### 1.4 修复分支（Fix）

- **名称**：`fix/问题描述`
- **用途**：
  - 修复生产环境或开发环境中的 bug
  - 基于 `main` 分支（生产 bug）或 `develop` 分支（开发 bug）创建
- **生命周期**：
  - bug 修复完成后，合并到对应的基础分支
  - 合并后删除该分支

### 1.5 发布分支（Release）

- **名称**：`release/版本号`
- **用途**：
  - 准备发布新版本
  - 进行最终的测试和调整
  - 基于 `develop` 分支创建
- **生命周期**：
  - 发布完成后，合并到 `main` 分支（并打标签）和 `develop` 分支
  - 合并后删除该分支

### 1.6 紧急修复分支（Hotfix）

- **名称**：`hotfix/问题描述`
- **用途**：
  - 紧急修复生产环境中的严重 bug
  - 基于 `main` 分支创建
- **生命周期**：
  - 修复完成后，合并到 `main` 分支（并打标签）和 `develop` 分支
  - 合并后删除该分支

## 2. 分支创建与合并流程

### 2.1 功能开发流程

1. **创建功能分支**：
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b feature/新功能名称
   ```

2. **开发功能**：
   - 进行代码修改
   - 定期提交代码
   - 编写测试用例

3. **提交代码**：
   ```bash
   git add .
   git commit -m "feat(功能名称): 功能描述"
   git push origin feature/新功能名称
   ```

4. **创建合并请求**：
   - 从 `feature/新功能名称` 分支向 `develop` 分支创建合并请求
   - 邀请团队成员进行代码审查
   - 解决审查中提出的问题

5. **合并功能**：
   - 代码审查通过后，合并到 `develop` 分支
   - 删除 `feature/新功能名称` 分支

### 2.2 Bug 修复流程

1. **创建修复分支**：
   - 生产 bug（基于 `main` 分支）：
     ```bash
     git checkout main
     git pull origin main
     git checkout -b fix/问题描述
     ```
   - 开发 bug（基于 `develop` 分支）：
     ```bash
     git checkout develop
     git pull origin develop
     git checkout -b fix/问题描述
     ```

2. **修复 bug**：
   - 进行代码修改
   - 编写测试用例验证修复

3. **提交代码**：
   ```bash
   git add .
   git commit -m "fix(问题描述): 修复说明"
   git push origin fix/问题描述
   ```

4. **创建合并请求**：
   - 从 `fix/问题描述` 分支向对应的基础分支（`main` 或 `develop`）创建合并请求
   - 邀请团队成员进行代码审查
   - 解决审查中提出的问题

5. **合并修复**：
   - 代码审查通过后，合并到对应的基础分支
   - 如果是生产 bug 修复，还需要合并到 `develop` 分支
   - 删除 `fix/问题描述` 分支

### 2.3 版本发布流程

1. **创建发布分支**：
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b release/v1.0.0
   ```

2. **准备发布**：
   - 更新版本号
   - 更新 CHANGELOG
   - 进行最终测试

3. **提交发布准备**：
   ```bash
   git add .
   git commit -m "release(v1.0.0): 准备发布版本 1.0.0"
   git push origin release/v1.0.0
   ```

4. **合并发布**：
   - 合并到 `main` 分支：
     ```bash
     git checkout main
     git merge --no-ff release/v1.0.0
     git tag -a v1.0.0 -m "版本 1.0.0 发布"
     git push origin main --tags
     ```
   - 合并到 `develop` 分支：
     ```bash
     git checkout develop
     git merge --no-ff release/v1.0.0
     git push origin develop
     ```

5. **删除发布分支**：
   ```bash
   git branch -d release/v1.0.0
   git push origin --delete release/v1.0.0
   ```

### 2.4 紧急修复流程

1. **创建紧急修复分支**：
   ```bash
   git checkout main
   git pull origin main
   git checkout -b hotfix/紧急问题描述
   ```

2. **修复问题**：
   - 进行紧急修复
   - 编写测试用例验证修复

3. **提交修复**：
   ```bash
   git add .
   git commit -m "hotfix(紧急问题描述): 紧急修复说明"
   git push origin hotfix/紧急问题描述
   ```

4. **合并修复**：
   - 合并到 `main` 分支：
     ```bash
     git checkout main
     git merge --no-ff hotfix/紧急问题描述
     git tag -a v1.0.1 -m "版本 1.0.1 紧急修复发布"
     git push origin main --tags
     ```
   - 合并到 `develop` 分支：
     ```bash
     git checkout develop
     git merge --no-ff hotfix/紧急问题描述
     git push origin develop
     ```

5. **删除紧急修复分支**：
   ```bash
   git branch -d hotfix/紧急问题描述
   git push origin --delete hotfix/紧急问题描述
   ```

## 3. 版本号规范

使用语义化版本号（Semantic Versioning）规范，格式为：`MAJOR.MINOR.PATCH`

- **MAJOR**：主版本号，当进行不兼容的 API 更改时递增
- **MINOR**：次版本号，当添加向后兼容的新功能时递增
- **PATCH**：修订版本号，当进行向后兼容的 bug 修复时递增

**示例**：
- `1.0.0`：初始版本
- `1.1.0`：添加了新功能
- `1.1.1`：修复了 bug
- `2.0.0`：进行了不兼容的 API 更改

## 4. CHANGELOG 规范

### 4.1 CHANGELOG 格式

```markdown
# CHANGELOG

## [版本号] - 发布日期

### 新增功能
- [功能描述] (#issue号)

### 修复问题
- [问题描述] (#issue号)

### 改进优化
- [改进描述] (#issue号)

### 文档更新
- [文档描述] (#issue号)
```

### 4.2 CHANGELOG 示例

```markdown
# CHANGELOG

## [1.1.0] - 2023-12-15

### 新增功能
- 添加搜索功能 (#123)
- 支持深色模式 (#124)

### 修复问题
- 修复首页布局错乱 (#125)
- 修复移动端导航栏显示问题 (#126)

### 改进优化
- 优化页面加载速度 (#127)
- 改进代码结构 (#128)

### 文档更新
- 更新 README 文档 (#129)
- 添加开发指南 (#130)
```

## 5. 分支管理最佳实践

1. **保持分支整洁**：
   - 定期删除不再需要的分支
   - 避免长期存在的功能分支

2. **频繁合并**：
   - 定期将 `develop` 分支合并到功能分支
   - 避免分支之间的差异过大

3. **提交规范**：
   - 使用清晰、简洁的提交消息
   - 遵循提交消息格式规范
   - 每个提交只包含一个逻辑变更

4. **代码审查**：
   - 所有代码变更都需要经过审查
   - 审查时关注代码质量和安全性
   - 给出具体、建设性的反馈

5. **自动化测试**：
   - 编写单元测试和集成测试
   - 在合并前运行测试
   - 确保测试覆盖关键功能

6. **文档更新**：
   - 及时更新相关文档
   - 保持文档与代码的一致性
   - 记录重要的设计决策

## 6. 工具支持

- **Git**：版本控制工具
- **GitHub/Gitee**：远程仓库托管平台
- **GitLab CI/CD**：持续集成和持续部署
- **Jira**：项目管理和 issue 跟踪
- **Conventional Commits**：提交消息规范
- **Semantic Versioning**：版本号规范

---

**注意**：这些策略是基于 Git Flow 工作流的，适用于大多数项目。在实际应用中，可以根据项目规模和团队需求进行调整。